# h5 Injected Sequel

## x) Lue/katso/kuuntele ja tiivistä.
Karvinen 2016: PostgreSQL Install and One Table Database – SQL CRUD tutorial for Ubuntu (Virtuaaliympäristöä ei tarvita, voit aloittaa kohdasta "Three line install"

- PostgreSQL asetaminen
- Taulun luominen
- Read, update, delete

OWASP 2017: A1:2017-Injection

Kuinka välttää:

- Datan erottamista komentoriveistä ja kyselyistä.
- Turvallista API:a tai ORM-työkalut.
- Positiivinen tai "whitelist" -pohjainen palvelinpohjainen syötteen tarkistus.
- Dynaamisille kyselyille käytä escape-syntaksia erikoismerkkien suojaamiseksi.
- Käytä SQL-ohjaimia, kuten LIMIT.

PortSwigger Academy: SQL injection

Paljon ja vähän lisää SQL injektioista.

SQL haavoittuvuus esiintyy yleensä WHERE-lausekkeen sisällä SELECT-kyselyssä.<br>UPDATE-lauseissa päivitettyjen arvojen tai WHERE-lausekkeen sisällä.<br>INSERT-lauseissa lisättyjen arvojen sisällä.<br>SELECT-lauseissa taulun tai sarakkeen nimen sisällä.<br>SELECT-lauseissa ORDER BY -lausekkeen sisällä.

SQL injektioiden estämisessä auttaa 'string concatenation' korvaaminen 'parameterized queries'.

## a) CRUD. Tee uusi PostgreSQL-tietokanta ja demonstroi sillä create, read, update, delete (CRUD). Keksi taulujen ja kenttien nimet itse. Taulujen nimet monikossa, kenttien nimet yksikössä, molemmat englanniksi.
PostgreSQL tietokannan asentaminen. Kun yritin asentaa sitä huomasin, että minulla oli postgreSQL jo asennettuna.

    $ sudo apt-get -y install postgresql 
![Alt text](/H5InjectedSequel/kuvat/h5.a1.png)

Sitten yritin luodan tietokanna ja tietokannalle käyttäjän. Oli hieman hämmentynyt vastauksista.

    $ sudo -u postgres createdb $(whoami)
    $ sudo -u postgres createuser $(whoami)

![Alt text](/H5InjectedSequel/kuvat/h5.a2.png)
![Alt text](/H5InjectedSequel/kuvat/h5.a3.png)

Hieman ihmettelin välissä, jonka jälkeen kokeilin tietokannan luontia uudestaan ja vastaus oli erilainen. Kai noi aikasemmat komennot tekivät oikeita asioita vaikka tuloste on hieman erikoinen.

![Alt text](/H5InjectedSequel/kuvat/h5.a4.png)

Kuitenkin uusi tietokanta näkyi SQL:ssä. Asiaa hieman googletettua päätin muuttaa kansioini oikeuksia.

    $ chmod og+rX /home /home/user

![Alt text](/H5InjectedSequel/kuvat/h5.a5.png)

Tämän jälkeen siirryin sql tilaan ja loin uuden taulun

    $ sudo -u postgres psql
    \c jokke
    CREATE TABLE taskh5 (id SERIAL PRIMARY KEY, name VARCHAR(10));

![Alt text](/H5InjectedSequel/kuvat/h5.a7.png)

CRUD:

- Create
Loin 'Create' osan taskh5 tauluun.

      $ INSERT INTO taskh5(name) VALUES ('Create');
- Read
Luin 'Create' osan sisällön.

      $ SELECT * FROM taskh5;
![Alt text](/H5InjectedSequel/kuvat/h5.a8.png)
- Update
Päivitin tauluun luodun tietueen nimen 'Create' nimeksi 'Update'.

      $ UPDATE taskh5 SET name='Update' WHERE name='Create';
![Alt text](/H5InjectedSequel/kuvat/h5.a9.png)
  
- Delete
Lisäsin ensiksi uuden tietueen

      INSERT INTO taskh5(name) VALUES ('PoistaTama');
![Alt text](/H5InjectedSequel/kuvat/h5.a10.png)

Ja poistin sen seuraavasti:

      DELETE FROM taskh5 WHERE name='PoistaTama';
![Alt text](/H5InjectedSequel/kuvat/h5.a11.png)





## Lähteet
1  https://terokarvinen.com/2023/eettinen-hakkerointi-2023/<br>2  https://terokarvinen.com/2016/03/05/postgresql-install-and-one-table-database-sql-crud-tutorial-for-ubuntu/<br>3  https://portswigger.net/web-security/sql-injection<br>https://owasp.org/www-project-top-ten/2017/A1_2017-Injection<br>4  https://dba.stackexchange.com/questions/54242/cannot-start-psql-with-user-postgres-could-not-change-directory-to-home-user<br>5


